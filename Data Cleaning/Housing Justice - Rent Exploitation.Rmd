---
title: "Housing Justice - Rent Exploitation"
author: "Sokona Mangane"
date: '2022-07-06'
output: html_document
code_folding: "hide"
---

We downloaded data from Census.gov using the get_acs function, did some data wrangling and cleaning, wrote them as a csv file so that we can import them into RMarkdown

```{r}
#code_folding: "hide" (hides the code but ppl can see the code if they want to)
knitr::opts_chunk$set(echo =  TRUE, warning = FALSE, message = FALSE) #doesn't show the messages or the warings, only code output, must be its in own code chunk to apply to all the subsequent ones
```

``` {r importing data}

#importing data
library(readr)
library(tidycensus)
library(tidyverse)
library(tigris)
library(leaflet)
library(sf)

ACS_Housing_Data <- read_csv("Housing_Data.csv")
Income_By_Tenure <- read_csv("Income_By_Tenure.csv")
Tenure <- read_csv("Tenure.csv")
Tenure_By_Income <- read_csv("Tenure_By_Income.csv")
Tenure_By_Race <- read_csv("Tenurebyrace.csv")
Poverty_By_Race <- read_csv("PovertyByRace.csv")


```
## Basic summary statistics: 

# How many renters are there in each county? of which demographics?

Petersburg, Hopewell, Charlottesville and Richmond have the highest percentage of renters.

```{r renter_pop, warning=FALSE, paged.print=TRUE}
Tenure <- Tenure[, 3:9]
Tenure <- full_join(Tenure, Tenure_By_Race, by = "County_fips")

Tenure %>% 
  mutate(Perc_rentersE = (RentersE/Total_OccupantsE)) %>% 
  group_by(County) %>% 
  summarize(Median_Perc_Renters = median(Perc_rentersE, na.rm = TRUE), Median_Perc_WRenters = median((White_rentersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_WOwners = median((White_ownersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_BRenters = median((Black_rentersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_BOwners = median((Black_ownersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_NativeAmOwners = median((NativeAm_ownersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_NativeAmRenters = median((NativeAm_rentersE/Total_OccupantsE), na.rm = TRUE),  Median_Perc_AsianOwners = median((Asian_ownersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_AsianRenters = median((Asian_rentersE/Total_OccupantsE), na.rm = TRUE), Median_Perc_PacificIslanderOwner = median((PacificIslander_ownerE/Total_OccupantsE), na.rm = TRUE), Median_Perc_PacificIslanderRenter = median((PacificIslander_renterE/Total_OccupantsE), na.rm = TRUE), Median_Perc_HispanicLatinoOwner = median((HispanicLatino_ownerE/Total_OccupantsE), na.rm = TRUE), Median_Perc_HispanicLationRenterE = median((HispanicLation_renterE/Total_OccupantsE), na.rm = TRUE)) %>% 
  mutate(across(c(2:14), scales::percent))

#graph!
```

# What is the average rent, income, and real estate taxes paid in each County? 

Highest rent: Fluvanna, Chesterfield, Henrico and Albemarle
Highest median real estate taxes: Albemare, Charlottesville, Richmond, and Chesterfeild

```{r Avg. Rent, Income, and Real Estate Taxes}
ACS_Housing_Data |>
  group_by(County) |>
  summarize(Median_rent = median(MedianRentE, na.rm = TRUE), Median_tax = median(MedianTaxesE, na.rm = TRUE), Median_income = median(MedianIncomeE, na.rm = TRUE))

```


# What is the average rent to tax ratio in each county?

Highest Rent Tax Ratio: Petersburg City, Chesterfeild, and Nelson

```{r Avg. Rent-to-Tax Ratio}

ACS_Housing_Data$RentTaxRatio <- round(ACS_Housing_Data$RentTaxRatio, 3)

ACS_Housing_Data %>% 
  group_by(County) %>% 
  summarize(Median_Rent_Tax_RaTio = median(RentTaxRatio, na.rm = TRUE))
  

```


# What is the average percent of rent of income in each county? Thus, which county is the most rent burdened?

Richmond, Charlottesville and Nelson are the most rent burdened counties. 

```{r Avg. Rent Burdened}

ACS_Housing_Data %>% 
  group_by(County) %>% 
  summarize(Median_perc_rent_income = median(PercRentBurdenE, na.rm = TRUE))

```


# What does the income and ratio look like there?

Although these three are the most rent burdened, it isn't obvious based on its rent to tax ratio and median household income, except for in Nelson county (which only has 5 observations in the tract)

1. Richmond: Median Income is $53,216.5 and the Rent to Tax Ratio is 0.484
2. Charlottesville: Median Income is $62,477.5 and the Rent to Tax Ratio is 0.4325
3. Nelson: Median Income is $53,579 and the Rent to Tax Ratio is 0.71

# How many are below the poverty level in this County? and which demographics?

We can reach the same conclusions here, with Richmond having the _third_ highest percentage of those below the poverty level.

1. Richmond: On average, 17.6% of the county is below the poverty level and people who are Black and Asian have the highest average percent of those below the poverty level.  
2. Charlottesville: On average, 15.3% of the county is below the poverty level and people who are Hispanic or Latino and Asian have the highest average percent of those below the poverty level.  
3. Nelson: On average, 12.9% of the county is below the poverty level and people who are Asian have the highest average percent of those below the poverty level (50%).  

# What is the income distribution in this census tract look like?

```{r income_levels (rent burdened counties)}

```


# Which county has the most students (includes Undergraduate and Graduate students)?

No one county has a disproportionate amount of students compared to the other, however, Richmond, Charlottesville, and Henrico have the highest student populations

```{r}

 ACS_Housing_Data %>% 
  group_by(County) %>% 
  summarize(Median_perc_students = median(Perc_StudentsE, na.rm = TRUE))




```


```{r bar graph of percent of students in each census tract in Richmond, Charlottesville and Henrico }
# Perc_students_County %>% 
#   geom_bar(aes(x = ))
```


# What does the income, and ratio look like there? 


1. Richmond: Median Income is $53,216.5 and the Rent to Tax Ratio is 0.484
2. Charlottesville: Median Income is $62,477.5 and the Rent to Tax Ratio is 0.433
3. Henrico: Median Income is $69,827 and the Rent to Tax Ratio is 0.659

# What are the income distributions in each census tract?

 
 What's considered low-income is dependent on the cost of living of that location, thus, we used the [HUD's](https://www.huduser.gov/portal/datasets/il/il2022/2022summary.odn) measure of Low-Income in Chartlottesville and Richmond as our threshold as well. Below is the Median Family Income for these cities and the definitions used by the HUD.
 
* Low-Income: "The calculation normally used, therefore, is to set the 4-person low-income limit at 1.6 (i.e. 80%/50%) times the relevant 4-person very low income limit"  
* Very Low-Income: "The 4-person Very Low-Income Limit (VLIL) is based on 50% of the median family income estimated for the Charlottesville, VA MSA."
* Extremely Low-Income: "The FY 2014 Consolidated Appropriations Act changed the definition of extremely low-income to be the greater of 30/50ths (60 percent) of the Section 8 very low-income limit or the poverty guideline as established by the Department of Health and Human Services (HHS), provided that this amount is not greater than the Section 8 50% very low-income limit."

The numbers on the site are after they've done their adjustments. We also looked at the [national poverty thresholds set by the Census Bureau] (https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-poverty-thresholds.html). Both websites have poverty levels depending on the family size. The Census Bureau also accounted for the number of children, whereas the HUD sets these thresholds based on the houshold occupancy. Therefore, we looked at the [Average Household Size Data Table](https://data.census.gov/cedsci/table?q=B25010) and calculated the Average in the counties we were looking at (Richmond: 2.5 and Chartlottesville: 2.34). We used the thresdolds for a family of 2.5 people (with no children). According to the Census Bureau, the weight average poverty thresholds for a family of 2.5 people is $18,662, which is way below the extremely low-income limits in Charlottesville and Richmond. 

(also include how you had to work iwht the categories already set by the cenus bureau, also note that the median for Charlottesville MSA excludes Louisa county)
 
Richmond
 
Median Family Income: $101,000

Charlottesville

Median Family Income: $111,200

```{r}
# # The Richmond, VA MSA contains the following areas: Amelia County, VA; Charles City County, VA; Chesterfield County, VA; 
# Dinwiddie County, VA; Goochland County, VA; Hanover County, VA; Henrico County, VA; King William County, VA; New Kent County, VA; Powhatan County, VA; Prince George County, VA; Sussex County, VA; Colonial Heights city, VA; Hopewell city, VA; 
# Petersburg city, VA; and Richmond city, VA. 

# The Charlottesville, VA MSA contains the following areas: Albemarle County, VA; Fluvanna County, VA; Greene County, VA; 
# Nelson County, VA; and Charlottesville city, VA.

charlottesvillemsa <- c("003", "540", "079", "065", "125")

Above_median <- c("Renter occupied: $>150k", "Renter occupied: $100k to  $149,999", "Owner occupied: $>150k", "Owner occupied: $100k to  $149,999")
lowincome <- c("Renter occupied: $50k to $74,999", "Owner occupied: $50k to $74,999")
very_lowincome <- c("Renter occupied: $35k to $49,999", "Owner occupied: $35k to $49,999")
extremely_lowincome <- c("Renter occupied: $25k to $34,999", "Renter occupied: $20k to $24,999", "Owner occupied: $25k to $34,999", "Owner occupied: $20k to $24,999")
below_avgpovertylvl <- c("Renter occupied: $15k to $19,999", "Renter occupied: $10k to $14,999", "Renter occupied: $5k to $9,999", "Renter occupied: <$5k", "Owner occupied: $15k to $19,999", "Owner occupied: $10k to $14,999", "Owner occupied: $5k to $9,999", "Owner occupied: <$5k")

# mutate_if(is.numeric, round)
# 
# cTBI <-  Tenure_By_Income %>% 
#   filter(County_fips %in% charlottesvillemsa)
# 
# rTBI <-  Tenure_By_Income %>% 
#   filter(County_fips %in% cvlrichmond)
# i = 0
# TenureByIncome <- TenureByIncome %>% 
#   while(i < len(TenureByIncome)){
#     if(TenureByIncome$County_fips %in% charlottesvillemsa){
#       mutate(Income_Level = case_when(
#         Variable %in% Above_median ~ "Above Med Family Income", 
#         Variable %in% lowincome ~ "Low Income",
#         Variable %in% very_lowincome ~ "Very Low Income",
#         Variable %in% extremely_lowincome ~ "Extremely Low Income",
#         Variable %in% below_avgpovertylvl ~ "Below National Avg. Poverty Level"
#          ) 
#       )
#     }
#     i = i + 1
#   }

```


# How does this compare to the average gini index and who's below poverty in each county?



```{r Below_poverty and Gini Index}
Poverty_By_Race %>% 
  group_by(County) %>% 
  summarize(Median_perc_below_poverty = median(Perc_Total_BelowPovertyE, na.rm = TRUE), Median_Gini_Index = median(Gini_IndexE, na.rm = TRUE))


```


# Which demographics are most likely to be below poverty and above (or at) in each county?

```{r Demographics of those below and above(or at) poverty}

PovertyBy_Race_County <- Poverty_By_Race %>% 
  group_by(County) %>% 
  summarize(Median_Perc_WBelowPoverty = median((Perc_BelowPoverty_WhiteE), na.rm = TRUE), Median_Perc_BBelowPoverty = median((Perc_BelowPoverty_BlackE), na.rm = TRUE), Median_Perc_NativeAm_BelowPoverty = median((Perc_BelowPoverty_NativeAmE), na.rm = TRUE),  Median_Perc_Asian_BelowPoverty = median((Perc_BelowPoverty_AsianE), na.rm = TRUE), Median_Perc_PacificIslander_BelowPoverty = median((Perc_BelowPoverty_PacificIslanderE), na.rm = TRUE), Median_Perc_HispanicLatino_BelowPoverty = median((Perc_BelowPoverty_HispanicLatinoE), na.rm = TRUE))

PovertyBy_Race_County

#graph!            
            
```

Plots from Previous RMarkdown on distribution

```{r distribution plots from old RMD}

#distrubtion of the rent tax ratio as a whole
ACS_Housing_Data %>% 
  ggplot(aes(ACS_Housing_Data$RentTaxRatio)) + 
  geom_histogram()

#distrubtion of the rent tax ratio by county
ACS_Housing_Data %>% 
  ggplot(aes(ACS_Housing_Data$RentTaxRatio)) + 
  geom_histogram() +
  facet_wrap(~County)

#distrubtion of the rent tax ratio by county (boxplot)
ACS_Housing_Data |>
  ggplot() +
  aes(x = County, y = RentTaxRatio) +
  geom_boxplot() 

```

